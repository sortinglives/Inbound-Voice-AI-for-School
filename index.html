<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retell Voice Agent Demo</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 0; background-color: #f0f2f5; }
        #status { margin-bottom: 20px; font-size: 1.1em; color: #333; }
        #startCall, #endCall {
            padding: 15px 30px;
            font-size: 1.2em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin: 5px;
        }
        #startCall { background-color: #28a745; color: white; }
        #startCall:hover { background-color: #218838; transform: translateY(-2px); }
        #endCall { background-color: #dc3545; color: white; display: none; } /* Initially hidden */
        #endCall:hover { background-color: #c82333; transform: translateY(-2px); }
        .container { background-color: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); text-align: center; }
        h1 { color: #333; margin-bottom: 30px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Talk to Our Voice Agent</h1>
        <p id="status">Click "Start Call" to begin.</p>
        <button id="startCall">Start Call</button>
        <button id="endCall">End Call</button>
    </div>

    <!-- Retell SDK Script -->
    <script src="https://unpkg.com/@retell-ai/retell-sdk/dist/retell-sdk.js"></script>
    <script>
        // REPLACE THIS WITH YOUR ACTUAL RETELL API KEY
        // DO NOT use your SECRET key directly in client-side code!
        // For a production app, you'd use a backend to generate a temporary token.
        // For a simple demo, a publishable API key is often sufficient if you understand the risks.
        const R_RETELL_API_KEY = "YOUR_RETELL_PUBLISHABLE_API_KEY"; // Get this from Retell Dashboard -> API Keys -> Create new -> "Publishable Key"

        // REPLACE THIS WITH YOUR RETELL AGENT ID
        const AGENT_ID = "YOUR_AGENT_ID"; // Get this from your Retell agent's settings

        let conversation;
        const statusElement = document.getElementById('status');
        const startButton = document.getElementById('startCall');
        const endButton = document.getElementById('endCall');

        startButton.addEventListener('click', async () => {
            statusElement.textContent = "Connecting...";
            startButton.disabled = true;

            try {
                // Initialize the Retell conversation with your API key and agent ID
                conversation = new Retell.WebClient({
                    retellApiKey: R_RETELL_API_KEY,
                    agentId: AGENT_ID
                });

                conversation.on('conversationStarted', () => {
                    statusElement.textContent = "Call started! You are connected to the agent. Say hello!";
                    startButton.style.display = 'none';
                    endButton.style.display = 'inline-block';
                    console.log('Conversation started!');
                });

                conversation.on('conversationEnded', ({ code, reason }) => {
                    statusElement.textContent = `Call ended. Code: ${code}, Reason: ${reason || 'User hung up'}`;
                    startButton.style.display = 'inline-block';
                    endButton.style.display = 'none';
                    startButton.disabled = false;
                    console.log('Conversation ended!', { code, reason });
                });

                conversation.on('error', (error) => {
                    statusElement.textContent = `Error: ${error.message}`;
                    startButton.disabled = false;
                    startButton.style.display = 'inline-block';
                    endButton.style.display = 'none';
                    console.error('Retell error:', error);
                });

                await conversation.start(); // Start the WebRTC connection
            } catch (error) {
                statusElement.textContent = `Failed to start call: ${error.message}`;
                startButton.disabled = false;
                console.error('Error starting conversation:', error);
            }
        });

        endButton.addEventListener('click', () => {
            if (conversation) {
                conversation.stop();
                statusElement.textContent = "Ending call...";
            }
        });
    </script>
</body>
</html>
